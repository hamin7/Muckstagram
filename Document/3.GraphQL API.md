## 3.0. Planning the API

- [x] Create account
- [ ] Request Secret => 페이지에 처음 접속하면 이메일을 입력 => 사용자의 이메일로 비밀값을 전송 (nodemailer)
- [ ] Like / Unlike a photo
- [ ] Comment on a photo
- [ ] Search by user
- [ ] Search by location
- [ ] See user profile
- [ ] Follow / Unfollow User
- [ ] See the full photo
- [ ] Edit my profile
- [ ] Log in => 
- [ ] Upload photo
- [ ] Edit the photo (Delete)
- [ ] See the feed

- 사용자들이 전송 받은 비밀값을 페이지에 붙여넣기 하면 로그인하게 되고, 그들이 이메일에 접근할 수 있다는 것을 확인!

## 3.1. Create Account Resolver

- graphql console에서 post 추가.
- Image/toggleLike 폴더 생성 => 이미 좋아요가 되어 있으면 좋아요 취소로 아이콘이 바뀔 것.
- createAccount 폴더 및 createAccount.graphql 파일 생성.
- 참고로 멀티 커서 키는 option + click.
- 그래서 resolver가 무엇인가???

### createAccount로 user 추가
  - command
  ~~~json
    mutation {
        createAccount (username:"gigi", email:"gianluigi@juventus.com", firstName:"Gianluigi", lastName:"Buffon"){
            id
        }
    }
  ~~~

  - 결과
  ~~~json
  {
    "data": {
      "createAccount": {
        "id": "ck77tw4291rqr0905yy5shirp"
      }
    }
  }
  ~~~

  ## 궁금? 이거 왜 로컬 playground에서는 되는데 서버 playground에서는 에러남??? 근데 또 console db에는 추가 됨.
  ~~~json
  {
    "data": null,
    "errors": [
        {
        "message": "Cannot query field 'createAccount' on type 'Mutation'. Did you mean 'createPost', 'createComment' or 'createRoom'? (line 2, column 3):\n  createAccount(username: \"gigi\", email: \"gianluigi@juventus.com\", firstName: \"Gianluigi\", lastName: \"Buffon\") {\n  ^",
        "locations": [
            {
            "line": 2,
            "column": 3
            }
        ]
        }
    ]
    }
  ~~~

### 참고 : 삭제하기

~~~json
mutation {
  deleteManyObjects(where: {
    id_not: 0
  }){
    count
  }
}
~~~

## 3.2. requestSecret Resolver

- requestSecret.graphql과 requestSecret.js 파일 생성.
- utils.js 생성.
- 로그인하면 토큰 부여.
- 사용자가 페이지에 접속해서 이메일 입력하면, 비밀값이 전송 되고, 사용자들은 그 비밀값을 복사-붙여넣기 해서 접속.
- 보통은 비밀번호를 쓰지만 비밀번호는 진부해~~~!
- Math.random을 이용하여 랜덤으로 adjectives와 nouns를 조합하여 단어를 생성해 주는 기능 만들기.
- Math.floor는 소숫점 아랫자리 숫자 버림, Math.ceil은 반대로 올림.
- user의 email이 인자로 입력된 email과 같은 사용자를 where로 찾을 것.
- id, username, email로만 사용자를 찾을 수 있음.
- bio로 사용자를 찾아서 갱신할 수 는 없음. 유니크한 특성들로만 사용자를 찾아서 갱신요청 할 수 있기 때문.
- lastName이나 bio같은 @unique가 없는 것들로는 사용자를 검색할 수 없고 많은 사용자들을 필터는 할 수 있음.
- 유니크한 특성이 아니라면 삭제나 수정 요청을 할 수 없음.

## 3.3. sendMail Function with Nodemailer

- secretRequest를 실제로 메일로 보내주기 위해 nodemailer를 사용.
- yarn add nodemailer
- utils에 sendMail을 만들자.
- nodemailer는 몇몇 기본값들로 transport라는 것을 만들고, 그것으로 sendMail을 요청하면 끝.
- sendgrid를 사용하겠다.
- yarn add nodemailer-sendgrid-transport
- api_user와 api_key는 .env에 저장.
- server.js에 utils를 import. process.env를 가져오려고 함.
- sendMail은 외부에서 사용하지 않으니 export 하지 않아도 됨. sendSecretMail을 사용할 것.
- 참고로 보내는 메일 주소 도메인을 가짜로 설정 하는 것은 정말 쉬워 보인다.